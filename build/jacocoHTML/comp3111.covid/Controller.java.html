<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deCOVID</a> &gt; <a href="index.source.html" class="el_package">comp3111.covid</a> &gt; <span class="el_source">Controller.java</span></div><h1>Controller.java</h1><pre class="source lang-java linenums">package comp3111.covid;

import java.io.File;

import javax.swing.JFileChooser;
import javax.swing.filechooser.FileNameExtensionFilter;

import comp3111.covid.datastorage.Database;
import comp3111.covid.tabs.*;
import javafx.animation.Animation;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.beans.property.IntegerProperty;
import javafx.beans.property.SimpleIntegerProperty;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.Tab;
import javafx.scene.control.TabPane;
import javafx.scene.control.TextArea;
import javafx.scene.text.Text;
import javafx.util.Duration;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.concurrent.TimeUnit;
/**
 * Building on the sample skeleton for 'ui.fxml' Controller Class generated by SceneBuilder 
 */
<span class="nc" id="L32">public class Controller {</span>

    
    @FXML private Button fileChoosingButton;
    @FXML private TextArea textAreaConsole; // the console
    @FXML private Label introLabel;
    
    // Tabs under the main Tab pane
    @FXML private Tab tabReport1;
    @FXML private Tab tabReport2;
    @FXML private Tab tabReport3;
    @FXML private Tab tabApp1;
    @FXML private Tab tabApp2;
    @FXML private Tab tabApp3;
    @FXML private Tab tabC3;
    
    // controller for all tabs
    @FXML private TabA1pageController tabA1pageController;
    @FXML private TabA2pageController tabA2pageController;
    @FXML private TabB1pageController tabB1pageController;
    @FXML private TabB2pageController tabB2pageController;
    @FXML private TabC1pageController tabC1pageController;
    @FXML private TabC2pageController tabC2pageController;
    @FXML private TabC3pageController tabC3pageController;
    
    @FXML private TabPane tabPane;
    @FXML private Text popUpMessageText;
    
    private Timeline timeline;
    private KeyFrame keyFrame;
    
<span class="nc" id="L63">    private final String introText = &quot;Welcome, young data explorer. Choose a dataset to start your journey.&quot;;</span>
<span class="nc" id="L64">    private Context context = Context.getInstance();</span>
<span class="nc" id="L65">    private Database database = context.getDatabase();</span>
    
    public void initialize() {
<span class="nc" id="L68">    	final IntegerProperty i = new SimpleIntegerProperty(0);</span>
<span class="nc" id="L69">    	timeline = new Timeline();</span>
<span class="nc" id="L70">    	keyFrame = new KeyFrame(</span>
<span class="nc" id="L71">    			Duration.seconds(0.075),</span>
    			event -&gt; {
<span class="nc bnc" id="L73" title="All 2 branches missed.">    				if(i.get() == this.introText.length()) {</span>
<span class="nc" id="L74">    					timeline.pause();</span>
<span class="nc" id="L75">    					i.set(0);</span>
    					try {
<span class="nc" id="L77">							TimeUnit.SECONDS.sleep(2);</span>
<span class="nc" id="L78">						} catch (InterruptedException e) {</span>

<span class="nc" id="L80">						}</span>
<span class="nc" id="L81">    					timeline.play();</span>
    				}else {
<span class="nc" id="L83">    					this.introLabel.setText(introText.substring(0,i.get()));</span>
<span class="nc" id="L84">    					i.set(i.get()+1);</span>
    				}
<span class="nc" id="L86">    			});</span>
<span class="nc" id="L87">    	timeline.getKeyFrames().add(keyFrame);</span>
<span class="nc" id="L88">    	timeline.setCycleCount(Animation.INDEFINITE);</span>
<span class="nc" id="L89">    	timeline.play();</span>
<span class="nc" id="L90">    }</span>
    
    
    /**
     * This method launches a JFileChooser with the restriction of only choosing csv files.
     * The returns null if &quot;cancel is pressed&quot;. 
     * Otherwise, it generates a file and will pass it to importCSVtoDatabase
     * @return a File object pointing to the chosen csv file
     * @see Controller#importCSVtoDatabase(ActionEvent)
     */
    
    protected File chooseCSVFile() {
<span class="nc" id="L102">    	JFileChooser csvChooser = new JFileChooser(&quot;.&quot;);</span>
<span class="nc" id="L103">    	FileNameExtensionFilter csvFilter = new FileNameExtensionFilter(&quot;CSV files&quot;, &quot;csv&quot;);</span>
<span class="nc" id="L104">    	csvChooser.setFileFilter(csvFilter);</span>
<span class="nc" id="L105">    	int chooserReturnVal = csvChooser.showOpenDialog(null);</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">    	if(chooserReturnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L107">    		File csvFile = csvChooser.getSelectedFile();</span>
<span class="nc" id="L108">    		System.out.println(csvFile.getAbsolutePath());</span>
<span class="nc" id="L109">    		return csvChooser.getSelectedFile();</span>
    	}
<span class="nc" id="L111">    	return null;</span>
    }
    
    /**
     * Triggered when the &quot;Choose Dataset&quot; button is pressed.
     * This method gets a csv file as a dataset from a the method chooseCSVFile().
     * Then, it passes the csv file to the database for the database to process.
     * The result is that the database would contain the data from the csv file.
     * Upon successful import, the method updates the UI elements and logic of all the tabs' controllers,
     * and unlocks the tabs for the user to interact with.
     * @param event JavaFX ActionEvent
     * @see Database
     */
    
    @FXML
    //triggered by button
    void importCSVtoDatabase(ActionEvent event) {
<span class="nc" id="L128">    	File csvFile = chooseCSVFile(); // Official function</span>

<span class="nc bnc" id="L130" title="All 2 branches missed.">    	if(csvFile != null) {</span>
<span class="nc" id="L131">    		this.database.importCSV(csvFile);</span>
<span class="nc" id="L132">    		LocalDateTime currentTime = LocalDateTime.now();</span>
<span class="nc" id="L133">    		LocalDate databaseEarlistTime = this.database.getEarliest();</span>
<span class="nc" id="L134">    		LocalDate databaseLastestTime = this.database.getLatest();</span>
<span class="nc" id="L135">    		String formattedTime = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;).format(currentTime);</span>
<span class="nc" id="L136">    		String importMessage = &quot;[ &quot; + formattedTime + &quot; ] &quot; + &quot;Successfully imported &quot; + csvFile.getName() + &quot;\n&quot;; </span>
<span class="nc" id="L137">    		String rangeMessage = &quot;[ &quot; + formattedTime + &quot; ] &quot; + &quot;Range of Date: &quot; + databaseEarlistTime + &quot; to &quot; + </span>
    							  databaseLastestTime + &quot;\n&quot;;
<span class="nc" id="L139">    		System.out.println(importMessage);</span>
<span class="nc" id="L140">    		System.out.println(rangeMessage);</span>
    		
<span class="nc" id="L142">    		timeline.stop();</span>
<span class="nc" id="L143">    		this.introLabel.setText(&quot;You can choose another dataset later&quot;);</span>
        	
<span class="nc" id="L145">        	this.tabA1pageController.updateCheckboxList();</span>
<span class="nc" id="L146">        	this.tabA2pageController.updateCheckboxList();</span>
<span class="nc" id="L147">        	this.tabB1pageController.updateCheckboxList();</span>
<span class="nc" id="L148">        	this.tabB2pageController.updateCheckboxList();</span>
<span class="nc" id="L149">        	this.tabC1pageController.updateCheckboxList();</span>
<span class="nc" id="L150">        	this.tabC2pageController.updateCheckboxList();</span>
<span class="nc" id="L151">        	this.tabC3pageController.initAfterImport();</span>
        	
<span class="nc" id="L153">        	this.tabReport1.setDisable(false);</span>
<span class="nc" id="L154">        	this.tabReport2.setDisable(false);</span>
<span class="nc" id="L155">        	this.tabReport3.setDisable(false);</span>
<span class="nc" id="L156">        	this.tabApp1.setDisable(false);</span>
<span class="nc" id="L157">        	this.tabApp2.setDisable(false);</span>
<span class="nc" id="L158">        	this.tabApp3.setDisable(false);</span>
<span class="nc" id="L159">        	this.tabC3.setDisable(false);</span>
    	}
<span class="nc" id="L161">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>